<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/assets/css/style.css">
  {% if cssFile %}
    <link rel="stylesheet" href="/assets/css/{{ cssFile }}">
  {% endif %}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Host+Grotesk:ital,wght@0,300..800;1,300..800&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  {% include "header.njk" %}
  {{ content | safe }}
  {% include "footer.njk" %}
  
  <script>
    // Handle Netlify Identity invitation flow
    document.addEventListener("DOMContentLoaded", function() {
      // Check if there's an invitation token in the URL
      if (window.location.hash && window.location.hash.includes('invite_token')) {
        console.log('Invitation token detected:', window.location.hash);
        
        // Wait for Netlify Identity to load
        const handleInvitation = () => {
          if (window.netlifyIdentity) {
            console.log('Netlify Identity loaded, processing invitation...');
            
            // Listen for successful login
            window.netlifyIdentity.on("login", () => {
              console.log('User logged in successfully, redirecting to admin...');
              window.location.href = "/admin/";
            });
            
            // Listen for errors
            window.netlifyIdentity.on("error", (err) => {
              console.error('Netlify Identity error:', err);
            });
            
            // The invitation should be processed automatically by Netlify Identity
            // when the page loads with the token in the URL
          } else {
            // Retry after a short delay
            setTimeout(handleInvitation, 100);
          }
        };
        
        handleInvitation();
      } else {
        // Normal login flow
        if (window.netlifyIdentity) {
          window.netlifyIdentity.on("init", user => {
            if (!user) {
              window.netlifyIdentity.on("login", () => {
                document.location.href = "/admin/";
              });
            }
          });
        }
      }
    });
  </script>
</body>
</html>
